loki.write "local" {
    endpoint {
        url = "http://loki:3100/loki/api/v1/push"
    }
}

loki.source.awsfirehose "loki_fh_receiver" {
    http {
        listen_address = "0.0.0.0"
        listen_port = 8080
    }
    forward_to = [
	loki.process.kinesis_firehose.receiver,
    ]
   
}

loki.process "kinesis_firehose"{

  stage.json {
    expressions = { "appname" = "app" }
   }

  stage.labels {
     values = {
       "spring_app" = "springAppName",
       "message" = "message",
       "level" = "level",
       "HOSTNAME" = "",
     }
   }

  stage.static_labels {
    values = {
      job = "kinesis_firehose",
    }
  }
  forward_to = [
     loki.write.local.receiver,
  ]
}
